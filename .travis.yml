language: go

go:
  - 1.5.2
  
before_install:
  - go get golang.org/x/tools/cmd/cover
  - go get github.com/onsi/gomega
  - go get github.com/onsi/ginkgo

script:
  - go test -tags json github.com/v2ray/v2ray-core/...
  
after_success:
  - ./testing/coverage/coverall

env:
  global:
    - secure: "FAiOIEl07CYf3vlkLKe4Tt49JD5z962JydHgtBlmy1WVBGQkP0zUSN4CNzVzJM9ceA5K0GaFE4nHEbmSuOf/hPKT+Vx7O8evMKHBnVxdjp0HC1Bo2G8Y1Jwz0hPkhS9z9fWszTRvwuAbjNE/LCVkQnN3+BgJr5LnKSHGH0Xm0o94W0DSyTzLkP2jeZQWabd1Bkt/6Pla8iToVJVPV05nSZgYlUidovDqYBY28iYyVXFefcOpDTDib9ObkPSIkOhiKkhq9pTTTn4XAMYLO+Lt2NXMA1rGY/f9YaGltZOAeocQGC8siINCoxKBzXkl7/YnyOGiz9YHpkz8//5J38hiEe1Is/we2bioH72lH2t5MFzRQzN+t0x2cGv8MhmYXxvjodqcgA3KdjnQtRZtVP7mPxEDt1FpX2SCF8ClVkSWbimSCmOlF/qje+aMf6cdCeo2JbHokPf2Lge7dbEHlUCUjpPVt1B5j7anJSbg71lHB76klEfVc6v/UEwyRpIdWSqurLIAIrLslzAVhhcmdZND7Hno+Lgf5JLlWy5h5jWAZHzYMRddvuUo+vSY+jyzHBI8NrqbYKufu26oGKOB2o4ekTxloOQ8k/Ya0K7Loyu5r453zen4cPwAfjKaJ2n66p5K3FpfuEPEXiCyh85VNeOxZuHxQiNB9tOEutTAQAfEZSo="

before_deploy:
  - rvm 1.9.3 do gem install mime-types -v 2.6.2
  - "./release/release.sh"

deploy:
  provider: releases
  api_key: 
    secure: "Nbno1ibFpq0DC6y0mkN6NFTbDQinRAEQo2Jl5lvsbiaX9m4CK59xG8XOcmZ3mqqdeioj6m9X5BVe2UtCZjmXmnyPq0FYNFHAPTfd2VrcOpi0fWLD9ndTYAsqjxrqPGK62XVjPbG8U2pGdq2yCOb0qQ9DlahDhVIMzQ/GYuRDps25fPGftepdPwlrwOfYCIvAHoi3GEozuS67WNEx/YtmZTce/2Qebdmwf44hUNaQibeXEspu9wQcp9M/i7aTuX/tUbn7rVCQ4TfoIJU1C1qKedUw0QYMjqP08Wn6UjwwhbblsJKFv8Kc0nx+i2K9CvvLyaBBIVY2Ggxj4Niy+X4VbyWWzdKx+0FXlmKh3U/hJdMZU3OrnwliBns2X3tCHSq7/+7ynLs3UZ4wCkCl7rQYucJ2mlvGquohQV6MX2vjl73y+pYljf+PKYbSDBb7iUOjllisRD+HmDmGQl81BvdEpN/K/BlfsTwHoHxsALSTjRljSngH51SUvjnaVbi/JolJ3lomTr1vCHl4WUiQVLnh7O2Cg7QLNMNieoblnh9yDQG9wC4xuzOJ/AaxRd/pRZMeIooQ1zsHOe+47C1YAep88b+9xtRqVMozAjk/XgNzWjuT2R8G7lZDq0mL9VajD/NUjM3Yrswoft9A3DRmR+lIFJR+fJb8tNf+k1OczE4lesg="
  file:
    - "$GOPATH/bin/v2ray-macos.zip"
    - "$GOPATH/bin/v2ray-windows-64.zip"
    - "$GOPATH/bin/v2ray-windows-32.zip"
    - "$GOPATH/bin/v2ray-linux-64.zip"
    - "$GOPATH/bin/v2ray-linux-32.zip"
    - "$GOPATH/bin/v2ray-linux-arm.zip"
    - "$GOPATH/bin/v2ray-linux-arm64.zip"
    - "$GOPATH/bin/metadata.txt"
  skip_cleanup: true
  on:
    tags: true
